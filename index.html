<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aditya Garg</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1B1464">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta property="og:title" content="Aditya Garg — Digital Business Card">
    <meta property="og:description" content="Tap to connect with Aditya Garg. Global trade, logistics & export-import solutions.">
    <meta property="og:type" content="profile">
    <link rel="preconnect" href="https://visiting-cards-8020e-default-rtdb.firebaseio.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{height:100%}
        body{
            font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            background:#F5F5F7;
            color:#1d1d1f;
            min-height:100vh;
            min-height:100dvh;
            -webkit-font-smoothing:antialiased;
            -webkit-text-size-adjust:100%;
            -webkit-tap-highlight-color:transparent;
            line-height:1.5;
        }
        .container{
            max-width:480px;
            margin:0 auto;
            min-height:100vh;
            min-height:100dvh;
            background:#fff;
            box-shadow:0 0 60px rgba(0,0,0,.08);
            overflow-x:hidden;
        }

        /* ── Waiting Screen ── */
        #waiting{
            background:linear-gradient(160deg,#1B1464 0%,#0a0a2e 100%);
            min-height:100vh;
            min-height:100dvh;
            display:flex;
            flex-direction:column;
        }
        .wait-header{
            padding:48px 24px 32px;
            padding-top:calc(48px + env(safe-area-inset-top));
            display:flex;
            flex-direction:column;
            align-items:center;
            text-align:center;
        }
        .wait-avatar{
            width:88px;
            height:88px;
            border-radius:50%;
            background:rgba(255,255,255,.1);
            border:3px solid rgba(255,255,255,.2);
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:28px;
            font-weight:700;
            color:#fff;
            letter-spacing:1px;
            position:relative;
            margin-bottom:20px;
        }
        .wait-avatar::after{
            content:'';
            position:absolute;
            inset:-10px;
            border-radius:50%;
            border:2px solid rgba(255,255,255,.1);
            animation:ping 2s ease-out infinite;
        }
        @keyframes ping{
            0%{transform:scale(1);opacity:.5}
            100%{transform:scale(1.4);opacity:0}
        }
        .wait-text{
            color:#fff;
            font-size:18px;
            font-weight:600;
            margin-bottom:8px;
        }
        .wait-sub{
            color:rgba(255,255,255,.5);
            font-size:14px;
            display:flex;
            align-items:center;
            gap:8px;
        }
        .dots{display:inline-flex;gap:4px}
        .dots span{
            width:6px;
            height:6px;
            border-radius:50%;
            background:rgba(255,255,255,.4);
            animation:dot 1.4s ease-in-out infinite;
        }
        .dots span:nth-child(2){animation-delay:.2s}
        .dots span:nth-child(3){animation-delay:.4s}
        @keyframes dot{
            0%,80%,100%{opacity:.3;transform:scale(1)}
            40%{opacity:1;transform:scale(1.2)}
        }
        .wait-phone{
            margin-top:20px;
            display:inline-flex;
            align-items:center;
            gap:10px;
            background:rgba(255,255,255,.1);
            padding:12px 20px;
            border-radius:12px;
            text-decoration:none;
            border:1px solid rgba(255,255,255,.1);
        }
        .wait-phone svg{width:18px;height:18px;fill:rgba(255,255,255,.7)}
        .wait-phone span{color:rgba(255,255,255,.85);font-size:15px;font-weight:500}

        /* ── Timeout notice ── */
        .timeout-notice{
            display:none;
            margin-top:24px;
            text-align:center;
            padding:0 24px;
        }
        .timeout-notice.show{display:block}
        .timeout-notice p{
            font-size:14px;
            color:rgba(255,255,255,.6);
            margin-bottom:4px;
        }

        /* ── Share form ── */
        .wait-form{
            flex:1;
            padding:24px;
            padding-bottom:calc(32px + env(safe-area-inset-bottom));
        }
        .wait-form-title{
            font-size:12px;
            font-weight:600;
            color:rgba(255,255,255,.5);
            text-transform:uppercase;
            letter-spacing:1.5px;
            margin-bottom:16px;
            text-align:center;
        }
        .wf-field{margin-bottom:12px}
        .wf-field input{
            width:100%;
            padding:14px 16px;
            border:1.5px solid rgba(255,255,255,.12);
            border-radius:12px;
            font-family:inherit;
            font-size:16px;
            color:#fff;
            background:rgba(255,255,255,.06);
            outline:none;
            -webkit-appearance:none;
        }
        .wf-field input::placeholder{color:rgba(255,255,255,.35)}
        .wf-field input:focus{
            border-color:rgba(255,255,255,.3);
            background:rgba(255,255,255,.1);
        }
        .wf-row{display:flex;gap:12px;margin-bottom:16px}
        .wf-photo-btn{
            display:flex;
            align-items:center;
            gap:10px;
            padding:12px 16px;
            border:1.5px solid rgba(255,255,255,.12);
            border-radius:12px;
            background:rgba(255,255,255,.06);
            font-family:inherit;
            font-size:14px;
            color:rgba(255,255,255,.6);
            cursor:pointer;
            flex:1;
        }
        .wf-photo-btn svg{width:20px;height:20px;fill:rgba(255,255,255,.5)}
        .wf-preview{
            width:48px;
            height:48px;
            border-radius:10px;
            object-fit:cover;
            display:none;
            border:2px solid rgba(255,255,255,.2);
        }
        .wf-scan-btn{
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            width:100%;
            padding:14px 16px;
            border:2px dashed rgba(255,255,255,.2);
            border-radius:12px;
            background:rgba(255,255,255,.04);
            font-family:inherit;
            font-size:14px;
            font-weight:500;
            color:rgba(255,255,255,.7);
            cursor:pointer;
            margin-bottom:16px;
        }
        .wf-scan-btn:active{transform:scale(.98);opacity:.8}
        .wf-scan-btn svg{width:22px;height:22px;fill:rgba(255,255,255,.6)}
        .wf-scan-btn.scanning{
            border-color:rgba(99,102,241,.4);
            background:rgba(99,102,241,.1);
            color:#a5b4fc;
        }
        .wf-scan-btn.scanning svg{fill:#a5b4fc;animation:pulse-icon 1s ease-in-out infinite}
        @keyframes pulse-icon{0%,100%{opacity:1}50%{opacity:.4}}
        .wf-scan-status{
            font-size:12px;
            color:rgba(255,255,255,.5);
            text-align:center;
            margin-bottom:12px;
            display:none;
        }
        .wf-scan-status.show{display:block}
        .wf-or{
            text-align:center;
            font-size:12px;
            color:rgba(255,255,255,.5);
            margin-bottom:14px;
            cursor:pointer;
            padding:8px;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:8px;
        }
        .wf-or:active{opacity:.7}
        .wf-or svg{width:16px;height:16px;fill:rgba(255,255,255,.5);transition:transform .3s}
        .wf-or.open svg{transform:rotate(180deg)}
        .wf-manual{
            max-height:0;
            overflow:hidden;
            transition:max-height .3s ease;
        }
        .wf-manual.open{max-height:400px}
        .wf-submit{
            width:100%;
            padding:16px;
            border:none;
            border-radius:14px;
            font-family:inherit;
            font-size:16px;
            font-weight:600;
            color:#fff;
            background:rgba(255,255,255,.15);
            cursor:pointer;
            -webkit-tap-highlight-color:transparent;
        }
        .wf-submit:active{opacity:.8;transform:scale(.98)}
        .wf-submit.sent{background:rgba(52,199,89,.4)}
        .wf-submit:disabled{opacity:.5}

        /* ── Card Screen ── */
        #card{display:none}
        #card.show{display:block;animation:cardFadeIn .5s ease}
        @keyframes cardFadeIn{from{opacity:0}to{opacity:1}}
        .hero{
            padding:56px 28px 40px;
            padding-top:calc(56px + env(safe-area-inset-top));
            text-align:center;
            position:relative;
            overflow:hidden;
        }
        .hero::before{
            content:'';
            position:absolute;
            top:-50%;left:-50%;
            width:200%;height:200%;
            background:radial-gradient(circle at 30% 20%,rgba(255,255,255,.12) 0%,transparent 50%);
            pointer-events:none;
        }
        .hero::after{
            content:'';
            position:absolute;
            bottom:0;left:0;right:0;
            height:80px;
            background:linear-gradient(transparent,rgba(255,255,255,.05));
            pointer-events:none;
        }
        .avatar{
            width:110px;
            height:110px;
            border-radius:50%;
            background:rgba(255,255,255,.12);
            backdrop-filter:blur(12px);
            -webkit-backdrop-filter:blur(12px);
            border:3px solid rgba(255,255,255,.2);
            display:flex;
            align-items:center;
            justify-content:center;
            margin:0 auto 28px;
            font-size:38px;
            font-weight:700;
            color:#fff;
            letter-spacing:2px;
            overflow:hidden;
            box-shadow:0 12px 40px rgba(0,0,0,.25),0 0 0 1px rgba(255,255,255,.1) inset;
            position:relative;
            z-index:1;
            animation:avatarPop .6s cubic-bezier(.34,1.56,.64,1) .1s both;
        }
        @keyframes avatarPop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
        .avatar img{width:100%;height:100%;object-fit:cover}
        .avatar-logo{width:75px;height:75px;object-fit:contain;filter:brightness(1.05)}
        .hero h1{
            color:#fff;
            font-size:28px;
            font-weight:700;
            letter-spacing:1.5px;
            text-transform:uppercase;
            margin-bottom:10px;
            text-shadow:0 2px 12px rgba(0,0,0,.2);
            position:relative;
            z-index:1;
            animation:textSlideUp .5s ease .2s both;
        }
        .hero p{
            color:rgba(255,255,255,.85);
            font-size:15px;
            font-weight:500;
            position:relative;
            z-index:1;
            animation:textSlideUp .5s ease .3s both;
        }
        @keyframes textSlideUp{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}

        /* ── Quick Actions ── */
        .quick-actions{
            display:flex;
            justify-content:center;
            gap:20px;
            padding:32px 24px 16px;
            animation:actionsSlide .5s ease .35s both;
        }
        @keyframes actionsSlide{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
        .action-btn{
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:10px;
            text-decoration:none;
            min-width:72px;
            transition:transform .2s ease;
        }
        .action-btn .ic{
            width:58px;
            height:58px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            box-shadow:0 4px 16px rgba(0,0,0,.08),0 1px 3px rgba(0,0,0,.04);
            transition:all .2s ease;
        }
        .action-btn:active{transform:scale(.92)}
        .action-btn:active .ic{box-shadow:0 2px 8px rgba(0,0,0,.06)}
        .action-btn .ic svg{width:24px;height:24px}
        .action-btn span{font-size:13px;font-weight:600;letter-spacing:.3px}

        /* ── Social Links ── */
        .social-row{
            display:flex;
            justify-content:center;
            gap:14px;
            padding:20px 24px 12px;
            animation:actionsSlide .5s ease .4s both;
        }
        .social-link{
            width:46px;
            height:46px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            text-decoration:none;
            box-shadow:0 2px 10px rgba(0,0,0,.06);
            transition:all .2s ease;
        }
        .social-link:active{transform:scale(.85)}
        .social-link svg{width:22px;height:22px}

        /* ── Save Contact ── */
        .save-contact{padding:24px 24px 20px;animation:actionsSlide .5s ease .45s both}
        .save-btn{
            display:flex;
            align-items:center;
            justify-content:center;
            gap:12px;
            width:100%;
            padding:17px 24px;
            color:#fff;
            border:none;
            border-radius:16px;
            font-family:inherit;
            font-size:16px;
            font-weight:600;
            cursor:pointer;
            box-shadow:0 8px 24px rgba(0,0,0,.18),0 2px 6px rgba(0,0,0,.08);
            -webkit-tap-highlight-color:transparent;
            transition:all .2s ease;
            position:relative;
            overflow:hidden;
        }
        .save-btn::before{
            content:'';
            position:absolute;
            top:0;left:0;right:0;bottom:0;
            background:linear-gradient(180deg,rgba(255,255,255,.15) 0%,transparent 50%);
            pointer-events:none;
        }
        .save-btn:active{transform:scale(.97);box-shadow:0 4px 16px rgba(0,0,0,.15)}
        .save-btn svg{width:22px;height:22px;fill:#fff}

        /* ── About ── */
        .about{padding:32px 24px;animation:sectionSlide .5s ease .5s both}
        @keyframes sectionSlide{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
        .section-title{
            font-size:11px;
            font-weight:700;
            text-transform:uppercase;
            letter-spacing:2px;
            margin-bottom:16px;
            opacity:.9;
        }
        .about p{font-size:15px;line-height:1.75;color:#444;letter-spacing:.2px}
        .about-text{position:relative}
        .about-text.collapsed{max-height:100px;overflow:hidden}
        .about-text.collapsed::after{
            content:'';
            position:absolute;
            bottom:0;
            left:0;
            right:0;
            height:60px;
            background:linear-gradient(transparent,#fff);
        }
        .view-more{
            display:none;
            background:none;
            border:none;
            font-family:inherit;
            font-size:14px;
            font-weight:600;
            cursor:pointer;
            padding:10px 0;
            margin-top:8px;
            transition:opacity .2s;
        }
        .view-more:active{opacity:.6}
        .view-more.show{display:inline-block}

        /* ── Contact Details ── */
        .contact-details{padding:12px 24px 36px;animation:sectionSlide .5s ease .55s both}
        .contact-item{
            display:flex;
            align-items:center;
            gap:16px;
            padding:16px 0;
            border-bottom:1px solid rgba(0,0,0,.06);
            text-decoration:none;
            color:inherit;
            transition:opacity .2s;
        }
        .contact-item:last-child{border-bottom:none}
        .contact-item:active{opacity:.6}
        .contact-item .ib{
            width:46px;
            height:46px;
            border-radius:14px;
            display:flex;
            align-items:center;
            justify-content:center;
            flex-shrink:0;
            box-shadow:0 2px 8px rgba(0,0,0,.04);
        }
        .contact-item .ib svg{width:20px;height:20px}
        .contact-item .detail{display:flex;flex-direction:column;gap:3px;min-width:0}
        .contact-item .label{
            font-size:10px;
            font-weight:700;
            color:#9ca3af;
            text-transform:uppercase;
        }
        .contact-item .value{font-size:15px;color:#1d1d1f;word-break:break-word;font-weight:500}

        /* ── Footer ── */
        .footer{
            text-align:center;
            padding:28px;
            padding-bottom:calc(28px + env(safe-area-inset-bottom));
            background:#fafafa;
            animation:sectionSlide .5s ease .6s both;
        }
        .footer p{font-size:12px;color:#9ca3af;font-weight:500;letter-spacing:.5px}
        .share-section{
            padding:20px;
            background:#f3f4f6;
            animation:sectionSlide .5s ease .55s both;
        }
        .share-btn{
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            width:100%;
            padding:14px 24px;
            border-radius:14px;
            background:#25D366;
            color:#fff;
            font-weight:600;
            font-size:15px;
            border:none;
            cursor:pointer;
            font-family:inherit;
            transition:transform .2s,box-shadow .2s;
        }
        .share-btn:active{transform:scale(.97)}
        .share-btn svg{width:22px;height:22px;fill:#fff}
        .powered-by{
            margin-top:12px;
            font-size:11px;
            color:#9ca3af;
        }
        .powered-by a{
            color:#6366f1;
            text-decoration:none;
            font-weight:500;
        }

        /* ── Product Gallery ── */
        .products{
            background:#fff;
            padding:20px;
            animation:sectionSlide .5s ease .45s both;
        }
        .products-scroll{
            display:flex;
            gap:12px;
            overflow-x:auto;
            scroll-snap-type:x mandatory;
            -webkit-overflow-scrolling:touch;
            padding-bottom:8px;
            margin:-4px;
            padding:4px;
        }
        .products-scroll::-webkit-scrollbar{display:none}
        .product-card{
            flex:0 0 140px;
            scroll-snap-align:start;
            background:#fafafa;
            border-radius:12px;
            overflow:hidden;
            box-shadow:0 2px 8px rgba(0,0,0,.06);
        }
        .product-img{
            width:100%;
            height:100px;
            object-fit:cover;
            background:#f3f4f6;
        }
        .product-info{
            padding:10px;
        }
        .product-name{
            font-size:13px;
            font-weight:600;
            color:#1f2937;
            margin-bottom:4px;
            line-height:1.3;
            display:-webkit-box;
            -webkit-line-clamp:2;
            -webkit-box-orient:vertical;
            overflow:hidden;
        }
        .product-price{
            font-size:12px;
            color:#6b7280;
            margin-bottom:8px;
        }
        .enquire-btn{
            width:100%;
            padding:8px;
            border-radius:8px;
            border:none;
            font-size:11px;
            font-weight:600;
            cursor:pointer;
            font-family:inherit;
            transition:transform .2s;
        }
        .enquire-btn:active{transform:scale(.96)}

        /* ── Transitions ── */
        #waiting.hide-out{
            opacity:0;
            transform:scale(.96);
            transition:all .3s ease-out;
            pointer-events:none;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Waiting Screen -->
    <div id="waiting">
        <div class="wait-header">
            <div class="wait-avatar">AG</div>
            <div class="wait-text">Connecting with Aditya</div>
            <div class="wait-sub">Preparing your card <span class="dots"><span></span><span></span><span></span></span></div>
            <a href="tel:+919560957474" class="wait-phone">
                <svg viewBox="0 0 24 24"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg>
                <span>+91 9560957474</span>
            </a>
            <!-- Timeout notice -->
            <div class="timeout-notice" id="timeoutNotice">
                <p>Loading your card...</p>
            </div>
        </div>
        <div class="wait-form">
            <div class="wait-form-title">While you wait — share your card</div>

            <!-- OCR Scan Button -->
            <label class="wf-scan-btn" id="scanBtn" for="scanPhoto">
                <svg viewBox="0 0 24 24"><path d="M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5zm-6 8h1.5v1.5H13V13zm1.5 1.5H16V16h-1.5v-1.5zM16 13h1.5v1.5H16V13zm-3 3h1.5v1.5H13V16zm1.5 1.5H16V19h-1.5v-1.5zM16 16h1.5v1.5H16V16zm1.5-1.5H19V16h-1.5v-1.5zm0 3H19V19h-1.5v-1.5zM19 13h-1.5v1.5H19V13z"/></svg>
                Scan my business card
            </label>
            <input type="file" id="scanPhoto" accept="image/*" capture="environment" style="display:none" onchange="scanCard(this)">
            <div class="wf-scan-status" id="scanStatus">Scanning card...</div>

            <div class="wf-or" id="manualToggle" onclick="toggleManual()">
                <span>— or fill manually —</span>
                <svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
            </div>

            <div class="wf-manual" id="manualFields">
                <div class="wf-field"><input type="text" id="vName" placeholder="Your name" autocomplete="name"></div>
                <div class="wf-field"><input type="tel" id="vPhone" placeholder="Phone number" autocomplete="tel"></div>
                <div class="wf-field"><input type="email" id="vEmail" placeholder="Email" autocomplete="email"></div>
                <div class="wf-field"><input type="text" id="vCompany" placeholder="Company" autocomplete="organization"></div>
                <div class="wf-row">
                    <label class="wf-photo-btn" for="vPhoto">
                        <svg viewBox="0 0 24 24"><path d="M9 3L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-3.17L15 3H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
                        Attach photo
                    </label>
                    <input type="file" id="vPhoto" accept="image/*" capture="environment" style="display:none" onchange="previewPhoto(this)">
                    <img class="wf-preview" id="photoPreview">
                </div>
                <button class="wf-submit" id="submitBtn" onclick="submitLead()">Share my details</button>
            </div>
        </div>
    </div>

    <!-- Card Display -->
    <div id="card"></div>
</div>

<script>
var DB = 'https://visiting-cards-8020e-default-rtdb.firebaseio.com';

var CARDS = {
    eximwala: {
        name:'Aditya Garg', title:'Director',
        company:'Eximwala Solutions Pte Ltd.',
        logo:'',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@eximwala.com',
        address:'21 Merchant Road, #04-614B, Royal Merukh S.E.A, Singapore 058267',
        addressQuery:'21+Merchant+Road+%2304-614B+Royal+Merukh+S.E.A+Singapore+058267',
        website:'https://eximwala.com', websiteDisplay:'eximwala.com',
        whatsapp:'919560957474',
        bio:'Director at Eximwala Solutions Pte Ltd., a Singapore-based company specializing in global trade and export-import solutions. We help businesses navigate international markets with end-to-end logistics, trade compliance, and supply chain management across Asia, Europe, and beyond.',
        color1:'#1B1464', color2:'#0D0D3B', accent:'#1B1464', accentLight:'#EEF0FF',
        vcardAdr:';;21 Merchant Road\\, #04-614B\\, Royal Merukh S.E.A;Singapore;;058267;Singapore',
        linkedin:'https://www.linkedin.com/company/eximwala-solutions-pte-ltd',
        instagram:'',
        twitter:'',
        calendly:''
    },
    shippingbaba: {
        name:'Aditya Garg', title:'Founder & CEO',
        company:'ShippingBaba',
        logo:'https://shippingbaba.com/images/lgLogo.svg',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@shippingbaba.com',
        address:'New Delhi, India', addressQuery:'New+Delhi+India',
        website:'https://shippingbaba.com', websiteDisplay:'shippingbaba.com',
        whatsapp:'919560957474',
        bio:'Founder & CEO at ShippingBaba, a global digital marketplace connecting cargo owners with vessel operators. Our AI-powered platform delivers transparent shipping with real-time vessel tracking, competitive freight rates, and seamless booking — making maritime logistics simple and accessible.',
        color1:'#0E7490', color2:'#064E5E', accent:'#0E7490', accentLight:'#ECFEFF',
        vcardAdr:';;New Delhi;;;110001;India',
        linkedin:'',
        instagram:'',
        twitter:'',
        calendly:''
    },
    viexports: {
        name:'Aditya Garg', title:'Managing Director',
        company:'Vi Exports India Pvt Ltd.',
        logo:'https://viexports.com/wp-content/uploads/2024/01/Untitled-design-16.webp',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@viexports.com',
        address:'New Delhi, India', addressQuery:'New+Delhi+India',
        website:'https://viexports.com', websiteDisplay:'viexports.com',
        whatsapp:'919560957474',
        bio:'Managing Director at Vi Exports India Pvt Ltd., a trusted Indian rice manufacturer and global exporter since 2020. We specialize in premium Basmati and non-Basmati rice varieties, spices, and oils — certified by FSSAI, HACCP, ISO 22000, and FDA. Serving clients across Europe, North America, Australia, and the Middle East.',
        color1:'#065F46', color2:'#043F2E', accent:'#065F46', accentLight:'#ECFDF5',
        vcardAdr:';;New Delhi;;;110001;India',
        linkedin:'',
        instagram:'https://www.instagram.com/viexportsindia/',
        twitter:'',
        calendly:'',
        products:[
            {name:'1121 Basmati Rice',price:'$850/MT',image:'https://viexports.com/wp-content/uploads/2024/01/1121-Basmati-Rice-1.jpg'},
            {name:'Pusa Basmati Rice',price:'$780/MT',image:'https://viexports.com/wp-content/uploads/2024/01/Pusa-Basmati-Rice-1.jpg'},
            {name:'Sella Basmati Rice',price:'$820/MT',image:'https://viexports.com/wp-content/uploads/2024/01/Sella-Basmati-Rice-1.jpg'},
            {name:'Non-Basmati Rice',price:'$450/MT',image:'https://viexports.com/wp-content/uploads/2024/01/Non-Basmati-Rice-1.jpg'}
        ]
    },
    devasya: {
        name:'Aditya Garg', title:'Director',
        company:'Devasya City Center',
        logo:'https://devasyahotel.com/wp-content/uploads/2024/04/devasya-1-logo.png',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@devasyahotel.com',
        address:'Plot No. 11, Maharaja Surajmal Marg, Shahdara, Delhi 110032',
        addressQuery:'Devasya+City+Center+Shahdara+Delhi',
        website:'https://devasyahotel.com', websiteDisplay:'devasyahotel.com',
        whatsapp:'919560957474',
        bio:'Director at Devasya City Center, a premium mixed-use destination in East Delhi featuring 5-star luxury office suites, vibrant retail shopping, and a curated food oasis — all under one roof. Located just 300m from Karkarduma Court Metro Station on Maharaja Surajmal Marg.',
        color1:'#8B6914', color2:'#5C4409', accent:'#8B6914', accentLight:'#FFF8E7',
        vcardAdr:';;Plot No. 11\\, Maharaja Surajmal Marg\\, Shahdara;Delhi;;110032;India',
        linkedin:'',
        instagram:'https://www.instagram.com/devasyaindia/',
        twitter:'',
        calendly:'',
        products:[
            {name:'Premium Office Suite',price:'From ₹50K/mo',image:'https://devasyahotel.com/wp-content/uploads/2024/04/office-suite.jpg'},
            {name:'Retail Space',price:'From ₹80K/mo',image:'https://devasyahotel.com/wp-content/uploads/2024/04/retail-space.jpg'},
            {name:'Food Court Stall',price:'From ₹35K/mo',image:'https://devasyahotel.com/wp-content/uploads/2024/04/food-court.jpg'}
        ]
    }
};

// Secure tokens - randomized unguessable strings mapped to card IDs
var TOKENS = {
    'x7k9m2p4q8':'eximwala',
    'h3j6n1r5t9':'shippingbaba',
    'b8c4f0w2y6':'viexports',
    'd5g1l7s3v0':'devasya'
};

// ── Detect direct link / QR parameter ──
var urlParams = new URLSearchParams(window.location.search);
var directCard = urlParams.get('c');
// Convert token to card ID if token is used
if (directCard && TOKENS[directCard]) {
    directCard = TOKENS[directCard];
}
var visitSource = 'nfc';
if (directCard) {
    visitSource = document.referrer ? 'link' : 'qr';
}

// ── Visitor info ──
var ua = navigator.userAgent;
var device = /iPhone/.test(ua)?'iPhone':/Android/.test(ua)?'Android':/iPad/.test(ua)?'iPad':'Desktop';
var browser = /CriOS|Chrome/.test(ua)?'Chrome':/Safari/.test(ua)?'Safari':/Firefox/.test(ua)?'Firefox':'Other';

// ── Session ──
var sid = Date.now().toString(36) + Math.random().toString(36).substr(2,5);
var leadSubmitted = false;
var cardPhotoData = null;
var timeoutTimer = null;
var defaultTimeoutCard = null; // fetched from Firebase

// ── Fetch admin's default card setting ──
fetch(DB+'/settings/defaultCard.json').then(function(r){return r.json()}).then(function(card){
    defaultTimeoutCard = card || null;
}).catch(function(){});

// ── Analytics helper ──
function trackEvent(cardId, category, action) {
    var payload = {ts:{'.sv':'timestamp'}, source:visitSource, action:action, device:device, browser:browser, sid:sid};
    fetch(DB+'/analytics/'+cardId+'/'+category+'.json',{method:'POST',body:JSON.stringify(payload)});
}

// ── Direct card link: skip waiting screen ──
if (directCard && CARDS[directCard]) {
    fetch(DB+'/taps/'+sid+'.json',{method:'PUT',body:JSON.stringify({
        status:'direct', card:directCard, source:visitSource, ts:{'.sv':'timestamp'},
        visitor:{device:device,browser:browser,lang:navigator.language||'',screen:screen.width+'x'+screen.height}
    })});
    showCard(directCard);
} else {
    // Normal NFC flow
    fetch(DB+'/taps/'+sid+'.json',{method:'PUT',body:JSON.stringify({
        status:'waiting', ts:{'.sv':'timestamp'}, source:'nfc',
        visitor:{device:device,browser:browser,lang:navigator.language||'',screen:screen.width+'x'+screen.height}
    })});
    fetch(DB+'/latest.json',{method:'PUT',body:JSON.stringify({
        sessionId:sid, ts:{'.sv':'timestamp'}, visitor:{device:device,browser:browser}
    })});

    // Listen for card selection
    var es = new EventSource(DB+'/taps/'+sid+'.json');
    function handleSSE(e) {
        try {
            var d = JSON.parse(e.data);
            var val = d.data;
            if (!val) return;
            if (val.card && CARDS[val.card]) { es.close(); clearTimeout(timeoutTimer); showCard(val.card); return; }
            if (typeof val === 'string' && CARDS[val]) { es.close(); clearTimeout(timeoutTimer); showCard(val); return; }
        } catch(err) {}
    }
    es.addEventListener('put', handleSSE);
    es.addEventListener('patch', handleSSE);

    // Timeout fallback (45 seconds)
    timeoutTimer = setTimeout(function() {
        document.getElementById('timeoutNotice').classList.add('show');
        fetch(DB+'/taps/'+sid+'/timeout.json',{method:'PUT',body:JSON.stringify(true)});
        // If admin set a default card, show it after brief notice
        if (defaultTimeoutCard && CARDS[defaultTimeoutCard]) {
            setTimeout(function() {
                if (typeof es !== 'undefined') es.close();
                visitSource = 'timeout';
                fetch(DB+'/taps/'+sid+'.json',{method:'PATCH',body:JSON.stringify({card:defaultTimeoutCard,status:'timeout-auto',source:'timeout'})});
                showCard(defaultTimeoutCard);
            }, 1500);
        }
        // If no default set, visitor stays on waiting screen
    }, 45000);
}

// ── Toggle manual input section ──
function toggleManual() {
    document.getElementById('manualToggle').classList.toggle('open');
    document.getElementById('manualFields').classList.toggle('open');
}

// ── Card Scan (quick submit for admin review) ──
function scanCard(input) {
    if (!input.files || !input.files[0]) return;

    var scanBtn = document.getElementById('scanBtn');
    var scanStatus = document.getElementById('scanStatus');

    scanBtn.classList.add('scanning');
    scanBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5zm-6 8h1.5v1.5H13V13zm1.5 1.5H16V16h-1.5v-1.5zM16 13h1.5v1.5H16V13zm-3 3h1.5v1.5H13V16zm1.5 1.5H16V19h-1.5v-1.5zM16 16h1.5v1.5H16V16zm1.5-1.5H19V16h-1.5v-1.5zm0 3H19V19h-1.5v-1.5zM19 13h-1.5v1.5H19V13z"/></svg>Uploading...';
    scanStatus.textContent = 'Sending to admin for review...';
    scanStatus.classList.add('show');

    var file = input.files[0];
    var reader = new FileReader();

    reader.onload = function(e) {
        var img = new Image();
        img.onload = function() {
            // Resize image
            var canvas = document.createElement('canvas');
            var max = 1000, w = img.width, h = img.height;
            if (w > max || h > max) {
                if (w > h) { h = h*max/w; w = max; } else { w = w*max/h; h = max; }
            }
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            var imageData = canvas.toDataURL('image/jpeg', 0.8);

            // Submit directly as lead needing review
            var leadData = {
                needsReview: true,
                cardImage: imageData,
                ts: {'.sv':'timestamp'},
                source: visitSource,
                visitor: {device:device, browser:browser}
            };

            fetch(DB+'/leads/'+sid+'.json', {method:'PUT', body:JSON.stringify(leadData)});
            fetch(DB+'/taps/'+sid+'/lead.json', {method:'PUT', body:JSON.stringify({needsReview:true, ts:{'.sv':'timestamp'}})});

            leadSubmitted = true;
            scanBtn.classList.remove('scanning');
            scanBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>Card sent!';
            scanStatus.textContent = 'Your card is queued for review. You can also add details below.';
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
    input.value = '';
}

// ── Lead form ──
function previewPhoto(input) {
    if (!input.files || !input.files[0]) return;
    var reader = new FileReader();
    reader.onload = function(e) {
        var img = new Image();
        img.onload = function() {
            var canvas = document.createElement('canvas');
            var max = 800, w = img.width, h = img.height;
            if (w > max || h > max) {
                if (w > h) { h = h*max/w; w = max; } else { w = w*max/h; h = max; }
            }
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            cardPhotoData = canvas.toDataURL('image/jpeg', 0.6);
            var p = document.getElementById('photoPreview');
            p.src = cardPhotoData; p.style.display = 'block';
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
}

function getLeadData() {
    var name = document.getElementById('vName').value.trim();
    var phone = document.getElementById('vPhone').value.trim();
    var email = document.getElementById('vEmail').value.trim();
    var company = document.getElementById('vCompany').value.trim();
    if (!name && !phone && !email) return null;
    var data = {name:name,phone:phone,email:email,company:company,ts:{'.sv':'timestamp'},source:visitSource,visitor:{device:device,browser:browser}};
    if (cardPhotoData) data.photo = cardPhotoData;
    return data;
}

function submitLead() {
    var data = getLeadData();
    if (!data) return;
    leadSubmitted = true;
    var body = JSON.stringify(data);
    fetch(DB+'/leads/'+sid+'.json',{method:'PUT',body:body});
    fetch(DB+'/taps/'+sid+'/lead.json',{method:'PUT',body:body});
    var btn = document.getElementById('submitBtn');
    btn.textContent = 'Shared!';
    btn.classList.add('sent');
    btn.disabled = true;
}

// ── Render card ──
function showCard(id) {
    var c = CARDS[id];
    if (!c) return;

    // Haptic feedback
    if (navigator.vibrate) navigator.vibrate(50);

    // Track view
    trackEvent(id, 'views', 'view');

    // Update lead with which card was shared
    fetch(DB+'/leads/'+sid+'/card.json',{method:'PUT',body:JSON.stringify(id)});

    var wa = encodeURIComponent('Hi '+c.name.split(' ')[0]+', I got your card!');
    var waitEl = document.getElementById('waiting');
    waitEl.classList.add('hide-out');
    setTimeout(function(){ waitEl.style.display = 'none'; }, 300);
    var el = document.getElementById('card');

    // Avatar: profile photo > company logo > initials
    var avatarContent;
    if (c.photo) {
        avatarContent = '<img src="'+c.photo+'" alt="'+c.name+'">';
    } else if (c.logo) {
        avatarContent = '<img class="avatar-logo" src="'+c.logo+'" alt="'+c.company+'">';
    } else {
        avatarContent = 'AG';
    }

    // Build card HTML
    var h = '<section class="hero" style="background:linear-gradient(160deg,'+c.color1+','+c.color2+')">'+
        '<div class="avatar">'+avatarContent+'</div>'+
        '<h1>'+c.name+'</h1><p>'+c.title+' · '+c.company+'</p></section>';

    h += '<div class="quick-actions">'+
        '<a href="tel:'+c.phone+'" class="action-btn" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'call\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg></div><span>Call</span></a>'+
        '<a href="https://wa.me/'+c.whatsapp+'?text='+wa+'" class="action-btn" target="_blank" rel="noopener" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'whatsapp\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347zM12.05 21.785h-.01a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.981.998-3.648-.235-.374A9.86 9.86 0 0 1 2.15 12.01C2.15 6.558 6.558 2.15 12.05 2.15c2.634 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.88 9.884v-.14zM20.52 3.449C18.24 1.245 15.24 0 12.05 0 5.464 0 .104 5.334.1 11.893a11.793 11.793 0 0 0 1.587 5.946L0 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.585 0 11.946-5.336 11.949-11.896a11.81 11.81 0 0 0-3.48-8.397z"/></svg></div><span>WhatsApp</span></a>'+
        '<a href="mailto:'+c.email+'" class="action-btn" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'email\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></div><span>Email</span></a></div>';

    // Social Links
    var socials = '';
    if (c.linkedin) socials += '<a href="'+c.linkedin+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'linkedin\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>';
    if (c.instagram) socials += '<a href="'+c.instagram+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'instagram\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg></a>';
    if (c.twitter) socials += '<a href="'+c.twitter+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'twitter\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>';
    if (c.calendly) socials += '<a href="'+c.calendly+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'calendly\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg></a>';
    if (socials) {
        h += '<div class="social-row">'+socials+'</div>';
    }

    h += '<div class="save-contact"><button class="save-btn" style="background:linear-gradient(135deg,'+c.color1+','+c.color2+')" onclick="saveContact(\''+id+'\');trackClick(\''+id+'\',\'save_contact\')"><svg viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/></svg>Save Contact</button></div>';

    // About
    var bioLong = c.bio.length > 180;
    h += '<section class="about"><h2 class="section-title" style="color:'+c.accent+'">About</h2><div class="about-text'+(bioLong?' collapsed':'')+'" id="aboutText"><p>'+c.bio+'</p></div>';
    if (bioLong) h += '<button class="view-more show" style="color:'+c.accent+'" onclick="toggleBio()">View more</button>';
    h += '</section>';

    // Products / Services
    if (c.products && c.products.length > 0) {
        h += '<section class="products"><h2 class="section-title" style="color:'+c.accent+'">Products & Services</h2><div class="products-scroll">';
        c.products.forEach(function(p) {
            h += '<div class="product-card"><img class="product-img" src="'+p.image+'" alt="'+p.name+'" onerror="this.style.display=\'none\'"><div class="product-info"><div class="product-name">'+p.name+'</div><div class="product-price">'+p.price+'</div><button class="enquire-btn" style="background:'+c.accentLight+';color:'+c.accent+'" onclick="enquireProduct(\''+id+'\',\''+p.name.replace(/'/g,"\\'")+'\')">Enquire</button></div></div>';
        });
        h += '</div></section>';
    }

    h += '<section class="contact-details"><h2 class="section-title" style="color:'+c.accent+'">Contact</h2>'+
        '<a href="tel:'+c.phone+'" class="contact-item" onclick="trackClick(\''+id+'\',\'call\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg></div><div class="detail"><span class="label">Phone</span><span class="value">'+c.phoneDisplay+'</span></div></a>'+
        '<a href="mailto:'+c.email+'" class="contact-item" onclick="trackClick(\''+id+'\',\'email\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></div><div class="detail"><span class="label">Email</span><span class="value">'+c.email+'</span></div></a>'+
        '<a href="https://maps.google.com/?q='+c.addressQuery+'" class="contact-item" target="_blank" rel="noopener"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg></div><div class="detail"><span class="label">Address</span><span class="value">'+c.address+'</span></div></a>'+
        '<a href="'+c.website+'" class="contact-item" target="_blank" rel="noopener" onclick="trackClick(\''+id+'\',\'website\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95a15.65 15.65 0 0 0-1.38-3.56A8.03 8.03 0 0 1 18.92 8zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56A7.987 7.987 0 0 1 5.08 16zm2.95-8H5.08a7.987 7.987 0 0 1 4.33-3.56A15.65 15.65 0 0 0 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg></div><div class="detail"><span class="label">Website</span><span class="value">'+c.websiteDisplay+'</span></div></a></section>';

    // Share section
    var shareUrl = encodeURIComponent(window.location.origin + '?c=' + (c.token || id));
    var shareText = encodeURIComponent('Check out ' + c.name + "'s digital business card:");
    h += '<section class="share-section">'+
        '<button class="share-btn" onclick="shareCard(\''+id+'\')">'+
        '<svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>'+
        'Share this card</button>'+
        '<p class="powered-by">Powered by <a href="https://berryhuman.in" target="_blank">BerryHuman</a></p></section>';

    h += '<footer class="footer"><p>'+c.company+' © 2026</p></footer>';
    el.innerHTML = h;
    el.classList.add('show');

    // Auto-submit lead data if any was filled
    if (!leadSubmitted) {
        var data = getLeadData();
        if (data) {
            var body = JSON.stringify(data);
            fetch(DB+'/leads/'+sid+'.json',{method:'PUT',body:body});
            fetch(DB+'/taps/'+sid+'/lead.json',{method:'PUT',body:body});
        }
    }
}

function trackClick(cardId, action) {
    if (navigator.vibrate) navigator.vibrate(30);
    trackEvent(cardId, 'clicks', action);
}

function enquireProduct(cardId, productName) {
    var c = CARDS[cardId];
    if (!c) return;
    if (navigator.vibrate) navigator.vibrate(30);
    trackEvent(cardId, 'clicks', 'product_enquiry');
    var msg = encodeURIComponent("Hi, I'm interested in: " + productName);
    window.open('https://wa.me/' + c.whatsapp + '?text=' + msg, '_blank');
}

function shareCard(cardId) {
    var c = CARDS[cardId];
    if (!c) return;
    trackEvent(cardId, 'clicks', 'share');
    var shareUrl = window.location.origin + '?c=' + (c.token || cardId);
    var shareText = 'Check out ' + c.name + "'s digital business card:";

    // Try native share first (mobile)
    if (navigator.share) {
        navigator.share({
            title: c.name + ' - Digital Card',
            text: shareText,
            url: shareUrl
        }).catch(function(){});
    } else {
        // Fallback to WhatsApp
        var waUrl = 'https://wa.me/?text=' + encodeURIComponent(shareText + ' ' + shareUrl);
        window.open(waUrl, '_blank');
    }
}

function toggleBio() {
    var t = document.getElementById('aboutText');
    var btn = t.nextElementSibling;
    if (t.classList.contains('collapsed')) {
        t.classList.remove('collapsed');
        btn.textContent = 'View less';
    } else {
        t.classList.add('collapsed');
        btn.textContent = 'View more';
    }
}

function saveContact(id) {
    var c = CARDS[id], p = c.name.split(' '), last = p.pop(), first = p.join(' ');
    var v = 'BEGIN:VCARD\nVERSION:3.0\nN:'+last+';'+first+';;;\nFN:'+c.name+'\nORG:'+c.company+'\nTITLE:'+c.title+'\nTEL;TYPE=CELL:'+c.phone+'\nEMAIL;TYPE=INTERNET:'+c.email+'\nADR;TYPE=WORK:'+c.vcardAdr+'\nURL:'+c.website+'\nEND:VCARD';
    var b = new Blob([v],{type:'text/vcard;charset=utf-8'});
    var u = URL.createObjectURL(b);
    var a = document.createElement('a');
    a.href = u; a.download = c.name.replace(/\s/g,'_')+'.vcf';
    document.body.appendChild(a); a.click();
    setTimeout(function(){ document.body.removeChild(a); URL.revokeObjectURL(u); },100);
}
</script>
</body>
</html>
