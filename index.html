<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aditya Garg</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1B1464">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta property="og:title" content="Aditya Garg — Digital Business Card">
    <meta property="og:description" content="Tap to connect with Aditya Garg. Global trade, logistics & export-import solutions.">
    <meta property="og:type" content="profile">
    <link rel="preconnect" href="https://visiting-cards-8020e-default-rtdb.firebaseio.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{height:100%;scroll-behavior:smooth}
        body{font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#F8F9FC;color:#333;min-height:100vh;min-height:100dvh;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent;overscroll-behavior:none}
        .container{max-width:480px;margin:0 auto;min-height:100vh;min-height:100dvh;background:#fff;box-shadow:0 0 40px rgba(0,0,0,.06);overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch}

        /* ── Global smooth transitions ── */
        button,a,.wf-field input{-webkit-tap-highlight-color:transparent;touch-action:manipulation}

        /* ── Ripple effect ── */
        .ripple{position:relative;overflow:hidden}
        .ripple::after{content:'';position:absolute;inset:0;background:radial-gradient(circle at var(--ripple-x,50%) var(--ripple-y,50%),rgba(255,255,255,.25) 0%,transparent 60%);opacity:0;transition:opacity .4s ease-out;pointer-events:none}
        .ripple:active::after{opacity:1;transition:opacity 0s}

        /* ── Waiting Screen ── */
        #waiting{background:linear-gradient(135deg,#1B1464 0%,#0D0D3B 100%);text-align:center;min-height:100vh;min-height:100dvh}
        .wait-header{padding:40px 24px 24px;padding-top:calc(40px + env(safe-area-inset-top));display:flex;flex-direction:column;align-items:center;animation:fadeSlideIn .6s cubic-bezier(.16,1,.3,1) both}
        @keyframes fadeSlideIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
        .wait-avatar{width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,.1);border:3px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:#fff;letter-spacing:2px;position:relative;margin-bottom:16px;animation:avatarIn .5s cubic-bezier(.34,1.56,.64,1) .1s both}
        @keyframes avatarIn{from{opacity:0;transform:scale(.6)}to{opacity:1;transform:scale(1)}}
        .wait-avatar::after{content:'';position:absolute;inset:-8px;border-radius:50%;border:2px solid rgba(255,255,255,.15);animation:ping 1.5s cubic-bezier(0,.4,.6,1) infinite}
        .wait-text{color:rgba(255,255,255,.9);font-size:16px;font-weight:500;margin-bottom:6px}
        .wait-sub{color:rgba(255,255,255,.45);font-size:12px;display:flex;align-items:center;gap:8px}
        .dots{display:inline-flex;gap:4px}
        .dots span{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.3);animation:dot 1.2s ease-in-out infinite}
        .dots span:nth-child(2){animation-delay:.2s}
        .dots span:nth-child(3){animation-delay:.4s}
        .wait-phone{margin-top:16px;display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.08);padding:10px 18px;border-radius:10px;text-decoration:none;transition:background .2s,transform .15s cubic-bezier(.34,1.56,.64,1);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}
        .wait-phone:active{transform:scale(.95);background:rgba(255,255,255,.14)}
        .wait-phone svg{width:16px;height:16px;fill:rgba(255,255,255,.6)}
        .wait-phone span{color:rgba(255,255,255,.7);font-size:13px;font-weight:500}
        @keyframes ping{0%{transform:scale(1);opacity:.6}100%{transform:scale(1.5);opacity:0}}
        @keyframes dot{0%,80%,100%{opacity:.3;transform:scale(1)}40%{opacity:1;transform:scale(1.3)}}

        /* ── Timeout fallback ── */
        .timeout-fallback{display:none;margin-top:20px;width:100%;padding:0 24px}
        .timeout-fallback.show{display:block;animation:timeoutIn .5s cubic-bezier(.16,1,.3,1) both}
        @keyframes timeoutIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .timeout-title{font-size:13px;color:rgba(255,255,255,.5);margin-bottom:12px}
        .timeout-cards{display:flex;flex-direction:column;gap:8px}
        .timeout-btn{width:100%;padding:14px 18px;border-radius:12px;border:none;color:#fff;font-family:inherit;font-size:14px;font-weight:600;cursor:pointer;text-align:left;transition:transform .2s cubic-bezier(.34,1.56,.64,1),box-shadow .2s;-webkit-touch-callout:none;position:relative;overflow:hidden}
        .timeout-btn:active{transform:scale(.96)}
        .timeout-btn:nth-child(1){animation:timeoutIn .4s cubic-bezier(.16,1,.3,1) .05s both}
        .timeout-btn:nth-child(2){animation:timeoutIn .4s cubic-bezier(.16,1,.3,1) .1s both}
        .timeout-btn:nth-child(3){animation:timeoutIn .4s cubic-bezier(.16,1,.3,1) .15s both}
        .timeout-btn:nth-child(4){animation:timeoutIn .4s cubic-bezier(.16,1,.3,1) .2s both}
        .timeout-btn small{display:block;font-weight:400;font-size:11px;opacity:.65;margin-top:2px}

        /* ── Share form on waiting screen ── */
        .wait-form{padding:20px 24px 32px;padding-bottom:calc(32px + env(safe-area-inset-bottom));text-align:left;animation:fadeSlideIn .6s cubic-bezier(.16,1,.3,1) .2s both}
        .wait-form-title{font-size:13px;font-weight:600;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:14px;text-align:center}
        .wf-field{margin-bottom:10px}
        .wf-field input{width:100%;padding:12px 14px;border:1.5px solid rgba(255,255,255,.12);border-radius:10px;font-family:inherit;font-size:14px;color:#fff;background:rgba(255,255,255,.06);outline:none;transition:border-color .2s,background .2s,box-shadow .2s,transform .15s;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
        .wf-field input::placeholder{color:rgba(255,255,255,.3);transition:opacity .2s}
        .wf-field input:focus{border-color:rgba(255,255,255,.35);background:rgba(255,255,255,.1);box-shadow:0 0 0 3px rgba(255,255,255,.06)}
        .wf-field input:focus::placeholder{opacity:.5}
        .wf-row{display:flex;gap:10px;margin-bottom:14px}
        .wf-photo-btn{display:flex;align-items:center;gap:8px;padding:10px 16px;border:1.5px solid rgba(255,255,255,.12);border-radius:10px;background:rgba(255,255,255,.06);font-family:inherit;font-size:13px;color:rgba(255,255,255,.5);cursor:pointer;flex:1;transition:background .2s,border-color .2s,transform .15s cubic-bezier(.34,1.56,.64,1)}
        .wf-photo-btn:active{transform:scale(.97);background:rgba(255,255,255,.1)}
        .wf-photo-btn svg{width:18px;height:18px;fill:rgba(255,255,255,.4)}
        .wf-preview{width:44px;height:44px;border-radius:8px;object-fit:cover;display:none;border:1.5px solid rgba(255,255,255,.15);animation:avatarIn .3s cubic-bezier(.34,1.56,.64,1) both}
        .wf-submit{width:100%;padding:13px;border:none;border-radius:10px;font-family:inherit;font-size:14px;font-weight:600;color:#fff;background:rgba(255,255,255,.15);cursor:pointer;transition:transform .2s cubic-bezier(.34,1.56,.64,1),background .25s,box-shadow .25s;position:relative;overflow:hidden}
        .wf-submit:active{transform:scale(.96)}
        .wf-submit:hover{background:rgba(255,255,255,.2)}
        .wf-submit.sent{background:rgba(34,197,94,.3);animation:submitPop .4s cubic-bezier(.34,1.56,.64,1)}
        .wf-submit:disabled{opacity:.5;transform:none}
        @keyframes submitPop{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

        /* ── Card Screen ── */
        #card{display:none}
        .card-enter{animation:cardReveal .4s cubic-bezier(.16,1,.3,1) both}
        @keyframes cardReveal{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}

        /* Staggered entrance animations with spring feel */
        .anim-hero{animation:heroIn .6s cubic-bezier(.34,1.56,.64,1) both}
        .anim-actions{animation:sectionIn .5s cubic-bezier(.34,1.56,.64,1) .12s both}
        .anim-social{animation:sectionIn .5s cubic-bezier(.34,1.56,.64,1) .18s both}
        .anim-save{animation:sectionIn .5s cubic-bezier(.34,1.56,.64,1) .24s both}
        .anim-about{animation:sectionIn .5s cubic-bezier(.34,1.56,.64,1) .3s both}
        .anim-details{animation:sectionIn .5s cubic-bezier(.34,1.56,.64,1) .36s both}
        .anim-footer{animation:sectionIn .5s cubic-bezier(.16,1,.3,1) .42s both}
        @keyframes heroIn{from{opacity:0;transform:translateY(-24px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
        @keyframes sectionIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

        .hero{padding:48px 24px 40px;padding-top:calc(48px + env(safe-area-inset-top));text-align:center;position:relative;overflow:hidden}
        .hero::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 30% 20%,rgba(255,255,255,.06) 0%,transparent 50%);pointer-events:none}
        .avatar{width:90px;height:90px;border-radius:50%;background:rgba(255,255,255,.12);border:3px solid rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:32px;font-weight:700;color:#fff;letter-spacing:2px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.2);transition:transform .3s cubic-bezier(.34,1.56,.64,1)}
        .avatar img{width:100%;height:100%;object-fit:cover}
        .avatar-logo{width:70px;height:70px;object-fit:contain}
        .hero h1{color:#fff;font-size:24px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:8px}
        .hero p{color:rgba(255,255,255,.75);font-size:14px}
        .quick-actions{display:flex;justify-content:center;gap:20px;padding:24px 24px 8px}
        .action-btn{display:flex;flex-direction:column;align-items:center;gap:8px;text-decoration:none;min-width:80px;transition:transform .15s cubic-bezier(.34,1.56,.64,1)}
        .action-btn .ic{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:transform .2s cubic-bezier(.34,1.56,.64,1),box-shadow .2s;box-shadow:0 2px 12px rgba(0,0,0,.06)}
        .action-btn:active .ic{transform:scale(.88);box-shadow:0 1px 4px rgba(0,0,0,.1)}
        .action-btn .ic svg{width:22px;height:22px}
        .action-btn span{font-size:12px;font-weight:500}

        /* ── Social Links Row ── */
        .social-row{display:flex;justify-content:center;gap:14px;padding:12px 24px 8px}
        .social-link{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;text-decoration:none;transition:transform .2s cubic-bezier(.34,1.56,.64,1),box-shadow .2s;box-shadow:0 2px 8px rgba(0,0,0,.04)}
        .social-link:active{transform:scale(.85);box-shadow:0 1px 2px rgba(0,0,0,.08)}
        .social-link svg{width:20px;height:20px}

        .save-contact{padding:16px 24px}
        .save-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:14px 20px;color:#fff;border:none;border-radius:12px;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;transition:transform .2s cubic-bezier(.34,1.56,.64,1),box-shadow .2s;box-shadow:0 4px 16px rgba(0,0,0,.15);position:relative;overflow:hidden}
        .save-btn:active{transform:scale(.96);box-shadow:0 2px 8px rgba(0,0,0,.2)}
        .save-btn svg{width:20px;height:20px;fill:#fff}
        .about{padding:24px}
        .section-title{font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px}
        .about p{font-size:14px;line-height:1.7;color:#555}
        .about-text{position:relative;transition:max-height .4s cubic-bezier(.16,1,.3,1)}
        .about-text.collapsed{max-height:100px;overflow:hidden}
        .about-text.collapsed::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40px;background:linear-gradient(transparent,#fff);pointer-events:none}
        .view-more{display:none;background:none;border:none;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;padding:4px 0;margin-top:4px;transition:color .15s}
        .view-more.show{display:inline-block}
        .view-more:active{opacity:.7}
        .contact-details{padding:8px 24px 24px}
        .contact-item{display:flex;align-items:flex-start;gap:14px;padding:14px 0;border-bottom:1px solid #F0F0F5;text-decoration:none;color:inherit;transition:background .15s,padding-left .15s;border-radius:8px;margin:0 -8px;padding-left:8px;padding-right:8px}
        .contact-item:active{background:rgba(0,0,0,.02);padding-left:12px}
        .contact-item:last-child{border-bottom:none}
        .contact-item .ib{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:transform .15s cubic-bezier(.34,1.56,.64,1)}
        .contact-item:active .ib{transform:scale(.92)}
        .contact-item .ib svg{width:18px;height:18px}
        .contact-item .detail{display:flex;flex-direction:column;gap:2px;min-width:0}
        .contact-item .label{font-size:11px;font-weight:500;color:#999;text-transform:uppercase;letter-spacing:.5px}
        .contact-item .value{font-size:14px;color:#333;word-break:break-word}
        .footer{text-align:center;padding:24px;padding-bottom:calc(24px + env(safe-area-inset-bottom));border-top:1px solid #F0F0F5}
        .footer p{font-size:12px;color:#aaa}

        /* ── Smooth waiting-to-card transition ── */
        #waiting{transition:opacity .3s ease-out,transform .3s ease-out}
        #waiting.hide-out{opacity:0;transform:scale(.97);pointer-events:none}
    </style>
</head>
<body>
<div class="container">
    <!-- Waiting Screen: header + form to share their card -->
    <div id="waiting">
        <div class="wait-header">
            <div class="wait-avatar">AG</div>
            <div class="wait-text">Connecting with Aditya...</div>
            <div class="wait-sub">Preparing your card <span class="dots"><span></span><span></span><span></span></span></div>
            <a href="tel:+919560957474" class="wait-phone">
                <svg viewBox="0 0 24 24"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg>
                <span>+91 9560957474</span>
            </a>
            <!-- Timeout fallback -->
            <div class="timeout-fallback" id="timeoutFallback">
                <div class="timeout-title">Taking longer? Pick a card:</div>
                <div class="timeout-cards">
                    <button class="timeout-btn" style="background:linear-gradient(135deg,#1B1464,#0D0D3B)" onclick="timeoutSelect('eximwala')">Eximwala Solutions<small>Director — Singapore</small></button>
                    <button class="timeout-btn" style="background:linear-gradient(135deg,#0E7490,#064E5E)" onclick="timeoutSelect('shippingbaba')">ShippingBaba<small>Founder & CEO — Shipping</small></button>
                    <button class="timeout-btn" style="background:linear-gradient(135deg,#065F46,#043F2E)" onclick="timeoutSelect('viexports')">Vi Exports India<small>Managing Director — Rice & Agri</small></button>
                    <button class="timeout-btn" style="background:linear-gradient(135deg,#8B6914,#5C4409)" onclick="timeoutSelect('devasya')">Devasya City Center<small>Director — Real Estate, Delhi</small></button>
                </div>
            </div>
        </div>
        <div class="wait-form">
            <div class="wait-form-title">While you wait — share your card</div>
            <div class="wf-field"><input type="text" id="vName" placeholder="Your name"></div>
            <div class="wf-field"><input type="tel" id="vPhone" placeholder="Phone number"></div>
            <div class="wf-field"><input type="email" id="vEmail" placeholder="Email"></div>
            <div class="wf-field"><input type="text" id="vCompany" placeholder="Company"></div>
            <div class="wf-row">
                <label class="wf-photo-btn" for="vPhoto">
                    <svg viewBox="0 0 24 24"><path d="M12 15.2l-3.2-3.2H11V8h2v4h2.2L12 15.2zM21 3h-6.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm9 16H3V5h18v14z"/></svg>
                    Photo of your card
                </label>
                <input type="file" id="vPhoto" accept="image/*" capture="environment" style="display:none" onchange="previewPhoto(this)">
                <img class="wf-preview" id="photoPreview">
            </div>
            <button class="wf-submit" id="submitBtn" onclick="submitLead()">Share my details</button>
        </div>
    </div>

    <!-- Card Display -->
    <div id="card"></div>
</div>

<script>
var DB = 'https://visiting-cards-8020e-default-rtdb.firebaseio.com';

var CARDS = {
    eximwala: {
        name:'Aditya Garg', title:'Director',
        company:'Eximwala Solutions Pte Ltd.',
        logo:'',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@eximwala.com',
        address:'21 Merchant Road, #04-614B, Royal Merukh S.E.A, Singapore 058267',
        addressQuery:'21+Merchant+Road+%2304-614B+Royal+Merukh+S.E.A+Singapore+058267',
        website:'https://eximwala.com', websiteDisplay:'eximwala.com',
        whatsapp:'919560957474',
        bio:'Director at Eximwala Solutions Pte Ltd., a Singapore-based company specializing in global trade and export-import solutions. We help businesses navigate international markets with end-to-end logistics, trade compliance, and supply chain management across Asia, Europe, and beyond.',
        color1:'#1B1464', color2:'#0D0D3B', accent:'#1B1464', accentLight:'#EEF0FF',
        vcardAdr:';;21 Merchant Road\\, #04-614B\\, Royal Merukh S.E.A;Singapore;;058267;Singapore',
        linkedin:'https://www.linkedin.com/in/adityagarg/',
        instagram:'',
        twitter:'',
        calendly:''
    },
    shippingbaba: {
        name:'Aditya Garg', title:'Founder & CEO',
        company:'ShippingBaba',
        logo:'https://shippingbaba.com/images/lgLogo.svg',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@shippingbaba.com',
        address:'New Delhi, India', addressQuery:'New+Delhi+India',
        website:'https://shippingbaba.com', websiteDisplay:'shippingbaba.com',
        whatsapp:'919560957474',
        bio:'Founder & CEO at ShippingBaba, a global digital marketplace connecting cargo owners with vessel operators. Our AI-powered platform delivers transparent shipping with real-time vessel tracking, competitive freight rates, and seamless booking — making maritime logistics simple and accessible.',
        color1:'#0E7490', color2:'#064E5E', accent:'#0E7490', accentLight:'#ECFEFF',
        vcardAdr:';;New Delhi;;;110001;India',
        linkedin:'https://www.linkedin.com/in/adityagarg/',
        instagram:'',
        twitter:'',
        calendly:''
    },
    viexports: {
        name:'Aditya Garg', title:'Managing Director',
        company:'Vi Exports India Pvt Ltd.',
        logo:'https://viexports.com/wp-content/uploads/2024/01/Untitled-design-16.webp',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@viexports.com',
        address:'New Delhi, India', addressQuery:'New+Delhi+India',
        website:'https://viexports.com', websiteDisplay:'viexports.com',
        whatsapp:'919560957474',
        bio:'Managing Director at Vi Exports India Pvt Ltd., a trusted Indian rice manufacturer and global exporter since 2020. We specialize in premium Basmati and non-Basmati rice varieties, spices, and oils — certified by FSSAI, HACCP, ISO 22000, and FDA. Serving clients across Europe, North America, Australia, and the Middle East.',
        color1:'#065F46', color2:'#043F2E', accent:'#065F46', accentLight:'#ECFDF5',
        vcardAdr:';;New Delhi;;;110001;India',
        linkedin:'https://www.linkedin.com/in/adityagarg/',
        instagram:'',
        twitter:'',
        calendly:''
    },
    devasya: {
        name:'Aditya Garg', title:'Director',
        company:'Devasya City Center',
        logo:'https://devasyahotel.com/wp-content/uploads/2024/04/devasya-1-logo.png',
        photo:'',
        phone:'+919560957474', phoneDisplay:'+91 9560957474',
        email:'info@devasyahotel.com',
        address:'Plot No. 11, Maharaja Surajmal Marg, Shahdara, Delhi 110032',
        addressQuery:'Devasya+City+Center+Shahdara+Delhi',
        website:'https://devasyahotel.com', websiteDisplay:'devasyahotel.com',
        whatsapp:'919560957474',
        bio:'Director at Devasya City Center, a premium mixed-use destination in East Delhi featuring 5-star luxury office suites, vibrant retail shopping, and a curated food oasis — all under one roof. Located just 300m from Karkarduma Court Metro Station on Maharaja Surajmal Marg.',
        color1:'#8B6914', color2:'#5C4409', accent:'#8B6914', accentLight:'#FFF8E7',
        vcardAdr:';;Plot No. 11\\, Maharaja Surajmal Marg\\, Shahdara;Delhi;;110032;India',
        linkedin:'https://www.linkedin.com/in/adityagarg/',
        instagram:'',
        twitter:'',
        calendly:''
    }
};

// ── Detect direct link / QR parameter ──
var urlParams = new URLSearchParams(window.location.search);
var directCard = urlParams.get('c');
var visitSource = 'nfc';
if (directCard) {
    visitSource = document.referrer ? 'link' : 'qr';
}

// ── Visitor info ──
var ua = navigator.userAgent;
var device = /iPhone/.test(ua)?'iPhone':/Android/.test(ua)?'Android':/iPad/.test(ua)?'iPad':'Desktop';
var browser = /CriOS|Chrome/.test(ua)?'Chrome':/Safari/.test(ua)?'Safari':/Firefox/.test(ua)?'Firefox':'Other';

// ── Session ──
var sid = Date.now().toString(36) + Math.random().toString(36).substr(2,5);
var leadSubmitted = false;
var cardPhotoData = null;
var timeoutTimer = null;

// ── Analytics helper ──
function trackEvent(cardId, category, action) {
    var payload = {ts:{'.sv':'timestamp'}, source:visitSource, action:action, device:device, browser:browser};
    fetch(DB+'/analytics/'+cardId+'/'+category+'.json',{method:'POST',body:JSON.stringify(payload)});
}

// ── Direct card link: skip waiting screen ──
if (directCard && CARDS[directCard]) {
    // Still log the tap for records
    fetch(DB+'/taps/'+sid+'.json',{method:'PUT',body:JSON.stringify({
        status:'direct', card:directCard, source:visitSource, ts:{'.sv':'timestamp'},
        visitor:{device:device,browser:browser,lang:navigator.language||'',screen:screen.width+'x'+screen.height}
    })});
    // Show card immediately
    showCard(directCard);
} else {
    // Normal NFC flow — fire writes
    fetch(DB+'/taps/'+sid+'.json',{method:'PUT',body:JSON.stringify({
        status:'waiting', ts:{'.sv':'timestamp'}, source:'nfc',
        visitor:{device:device,browser:browser,lang:navigator.language||'',screen:screen.width+'x'+screen.height}
    })});
    fetch(DB+'/latest.json',{method:'PUT',body:JSON.stringify({
        sessionId:sid, ts:{'.sv':'timestamp'}, visitor:{device:device,browser:browser}
    })});

    // Listen for card selection
    var es = new EventSource(DB+'/taps/'+sid+'.json');
    function handleSSE(e) {
        var d = JSON.parse(e.data);
        var val = d.data;
        if (!val) return;
        if (val.card && CARDS[val.card]) { es.close(); clearTimeout(timeoutTimer); showCard(val.card); return; }
        if (typeof val === 'string' && CARDS[val]) { es.close(); clearTimeout(timeoutTimer); showCard(val); return; }
    }
    es.addEventListener('put', handleSSE);
    es.addEventListener('patch', handleSSE);

    // ── Timeout fallback (45 seconds) ──
    timeoutTimer = setTimeout(function() {
        document.getElementById('timeoutFallback').classList.add('show');
        fetch(DB+'/taps/'+sid+'/timeout.json',{method:'PUT',body:JSON.stringify(true)});
    }, 45000);
}

function timeoutSelect(cardId) {
    if (typeof es !== 'undefined') es.close();
    clearTimeout(timeoutTimer);
    visitSource = 'timeout';
    fetch(DB+'/taps/'+sid+'.json',{method:'PATCH',body:JSON.stringify({card:cardId,status:'timeout-selected',source:'timeout'})});
    showCard(cardId);
}

// ── Lead form ──
function previewPhoto(input) {
    if (!input.files || !input.files[0]) return;
    var reader = new FileReader();
    reader.onload = function(e) {
        var img = new Image();
        img.onload = function() {
            var canvas = document.createElement('canvas');
            var max = 800, w = img.width, h = img.height;
            if (w > max || h > max) {
                if (w > h) { h = h*max/w; w = max; } else { w = w*max/h; h = max; }
            }
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            cardPhotoData = canvas.toDataURL('image/jpeg', 0.6);
            var p = document.getElementById('photoPreview');
            p.src = cardPhotoData; p.style.display = 'block';
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
}

function getLeadData() {
    var name = document.getElementById('vName').value.trim();
    var phone = document.getElementById('vPhone').value.trim();
    var email = document.getElementById('vEmail').value.trim();
    var company = document.getElementById('vCompany').value.trim();
    if (!name && !phone && !email) return null;
    var data = {name:name,phone:phone,email:email,company:company,ts:{'.sv':'timestamp'},source:visitSource,visitor:{device:device,browser:browser}};
    if (cardPhotoData) data.photo = cardPhotoData;
    return data;
}

function submitLead() {
    var data = getLeadData();
    if (!data) return;
    leadSubmitted = true;
    var body = JSON.stringify(data);
    fetch(DB+'/leads/'+sid+'.json',{method:'PUT',body:body});
    fetch(DB+'/taps/'+sid+'/lead.json',{method:'PUT',body:body});
    var btn = document.getElementById('submitBtn');
    btn.textContent = 'Shared!';
    btn.classList.add('sent');
    btn.disabled = true;
}

// ── Render card ──
function showCard(id) {
    var c = CARDS[id];
    if (!c) return;

    // Haptic feedback
    if (navigator.vibrate) navigator.vibrate(50);

    // Track view
    trackEvent(id, 'views', 'view');

    // Update lead with which card was shared
    fetch(DB+'/leads/'+sid+'/card.json',{method:'PUT',body:JSON.stringify(id)});

    var wa = encodeURIComponent('Hi '+c.name.split(' ')[0]+', I got your card!');
    var waitEl = document.getElementById('waiting');
    waitEl.classList.add('hide-out');
    setTimeout(function(){ waitEl.style.display = 'none'; }, 300);
    var el = document.getElementById('card');

    // Avatar: profile photo > company logo > initials
    var avatarContent;
    if (c.photo) {
        avatarContent = '<img src="'+c.photo+'" alt="'+c.name+'">';
    } else if (c.logo) {
        avatarContent = '<img class="avatar-logo" src="'+c.logo+'" alt="'+c.company+'">';
    } else {
        avatarContent = 'AG';
    }

    // Build card HTML with staggered animations
    var h = '<section class="hero anim-hero" style="background:linear-gradient(135deg,'+c.color1+','+c.color2+')">'+
        '<div class="avatar">'+avatarContent+'</div>'+
        '<h1>'+c.name+'</h1><p>'+c.title+' | '+c.company+'</p></section>';

    h += '<div class="quick-actions anim-actions">'+
        '<a href="tel:'+c.phone+'" class="action-btn" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'call\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg></div><span>Call</span></a>'+
        '<a href="https://wa.me/'+c.whatsapp+'?text='+wa+'" class="action-btn" target="_blank" rel="noopener" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'whatsapp\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347zM12.05 21.785h-.01a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.981.998-3.648-.235-.374A9.86 9.86 0 0 1 2.15 12.01C2.15 6.558 6.558 2.15 12.05 2.15c2.634 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.88 9.884v-.14zM20.52 3.449C18.24 1.245 15.24 0 12.05 0 5.464 0 .104 5.334.1 11.893a11.793 11.793 0 0 0 1.587 5.946L0 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.585 0 11.946-5.336 11.949-11.896a11.81 11.81 0 0 0-3.48-8.397z"/></svg></div><span>WhatsApp</span></a>'+
        '<a href="mailto:'+c.email+'" class="action-btn" style="color:'+c.accent+'" onclick="trackClick(\''+id+'\',\'email\')"><div class="ic" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></div><span>Email</span></a></div>';

    // Social Links Row
    var socials = '';
    if (c.linkedin) socials += '<a href="'+c.linkedin+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'linkedin\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>';
    if (c.instagram) socials += '<a href="'+c.instagram+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'instagram\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg></a>';
    if (c.twitter) socials += '<a href="'+c.twitter+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'twitter\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>';
    if (c.calendly) socials += '<a href="'+c.calendly+'" target="_blank" rel="noopener" class="social-link" style="background:'+c.accentLight+'" onclick="trackClick(\''+id+'\',\'calendly\')"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg></a>';
    if (socials) {
        h += '<div class="social-row anim-social">'+socials+'</div>';
    }

    h += '<div class="save-contact anim-save"><button class="save-btn" style="background:linear-gradient(135deg,'+c.color1+','+c.color2+')" onclick="saveContact(\''+id+'\');trackClick(\''+id+'\',\'save_contact\')"><svg viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/></svg>Save Contact</button></div>';

    // About with view more/less
    var bioLong = c.bio.length > 200;
    h += '<section class="about anim-about"><h2 class="section-title" style="color:'+c.accent+'">About</h2><div class="about-text'+(bioLong?' collapsed':'')+'" id="aboutText"><p>'+c.bio+'</p></div>';
    if (bioLong) h += '<button class="view-more show" style="color:'+c.accent+'" onclick="toggleBio()">View more</button>';
    h += '</section>';

    h += '<section class="contact-details anim-details"><h2 class="section-title" style="color:'+c.accent+'">Contact</h2>'+
        '<a href="tel:'+c.phone+'" class="contact-item" onclick="trackClick(\''+id+'\',\'call\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 4a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg></div><div class="detail"><span class="label">Phone</span><span class="value">'+c.phoneDisplay+'</span></div></a>'+
        '<a href="mailto:'+c.email+'" class="contact-item" onclick="trackClick(\''+id+'\',\'email\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></div><div class="detail"><span class="label">Email</span><span class="value">'+c.email+'</span></div></a>'+
        '<a href="https://maps.google.com/?q='+c.addressQuery+'" class="contact-item" target="_blank" rel="noopener"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"/></svg></div><div class="detail"><span class="label">Address</span><span class="value">'+c.address+'</span></div></a>'+
        '<a href="'+c.website+'" class="contact-item" target="_blank" rel="noopener" onclick="trackClick(\''+id+'\',\'website\')"><div class="ib" style="background:'+c.accentLight+'"><svg viewBox="0 0 24 24" fill="'+c.accent+'"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95a15.65 15.65 0 0 0-1.38-3.56A8.03 8.03 0 0 1 18.92 8zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56A7.987 7.987 0 0 1 5.08 16zm2.95-8H5.08a7.987 7.987 0 0 1 4.33-3.56A15.65 15.65 0 0 0 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg></div><div class="detail"><span class="label">Website</span><span class="value">'+c.websiteDisplay+'</span></div></a></section>';

    h += '<footer class="footer anim-footer"><p>'+c.company+' &copy; 2026</p></footer>';
    el.innerHTML = h;
    el.style.display = 'block';

    // If lead wasn't submitted yet, auto-submit any filled fields
    if (!leadSubmitted) {
        var data = getLeadData();
        if (data) {
            var body = JSON.stringify(data);
            fetch(DB+'/leads/'+sid+'.json',{method:'PUT',body:body});
            fetch(DB+'/taps/'+sid+'/lead.json',{method:'PUT',body:body});
        }
    }
}

function trackClick(cardId, action) {
    if (navigator.vibrate) navigator.vibrate(30);
    trackEvent(cardId, 'clicks', action);
}

function toggleBio() {
    var t = document.getElementById('aboutText');
    var btn = t.nextElementSibling;
    if (t.classList.contains('collapsed')) {
        t.classList.remove('collapsed');
        btn.textContent = 'View less';
    } else {
        t.classList.add('collapsed');
        btn.textContent = 'View more';
    }
}

function saveContact(id) {
    var c = CARDS[id], p = c.name.split(' '), last = p.pop(), first = p.join(' ');
    var v = 'BEGIN:VCARD\nVERSION:3.0\nN:'+last+';'+first+';;;\nFN:'+c.name+'\nORG:'+c.company+'\nTITLE:'+c.title+'\nTEL;TYPE=CELL:'+c.phone+'\nEMAIL;TYPE=INTERNET:'+c.email+'\nADR;TYPE=WORK:'+c.vcardAdr+'\nURL:'+c.website+'\nEND:VCARD';
    var b = new Blob([v],{type:'text/vcard;charset=utf-8'});
    var u = URL.createObjectURL(b);
    var a = document.createElement('a');
    a.href = u; a.download = c.name.replace(/\s/g,'_')+'.vcf';
    document.body.appendChild(a); a.click();
    setTimeout(function(){ document.body.removeChild(a); URL.revokeObjectURL(u); },100);
}
</script>
</body>
</html>
